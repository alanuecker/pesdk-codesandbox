import{q as e,V as i,u as t,T as r,k as o,I as s}from"./index-bd632e71.js";var n="4.22.2",a=function(){function t(e,t,r,o){var s=this;this.serializeMaxWidth=function(e){return e/s.untransformedImageSize.width},this.previewRelativeToImageDimensions=function(e){return s.relativeToOutputContainer(e).divide(i.fromSize(s.previewSize))},this.relativeToOutputContainer=function(e){return new i(e).subtract(new i(s.previewPosition))},this.relativeToImageDimensions=function(e){return new i(e).divide(i.fromSize(s.previewSize))},this.relativeToShotestImageEdge=function(e){return e/Math.min(s.transformedImageSize.height,s.transformedImageSize.width)},this.getPointInDirection=function(e,i,t){void 0===i&&(i=0),void 0===t&&(t=3);var r=Math.tan(i),o=Math.sqrt(Math.pow(r,2)+1);return{x:e.x+t/o,y:e.y+t*r/o}},this.previewPosition=e,this.previewSize=t,this.transformedImageSize=r,this.untransformedImageSize=o}return t.prototype.serialise=function(e,i){var r=this,o=this.serializeMetaData(),s={width:this.transformedImageSize.width,height:this.transformedImageSize.height};i&&(s.data=i);var n=[],a=[],l=e.adjustment;Object.keys(l).map((function(e){return l[e]})).filter(Boolean).length&&n.push(this.serializeAdjustments(l));var p=e.filter;"identity"!==p.identifier&&n.push(this.serializeFilters(p));var d=e.overlay;"identity"!==d.identifier&&a.push(this.serialzeOverlay(d));var u=e.frame;"identity"!==u.identifier&&a.push(this.serialzeFrame(u));var m=e.focus;if("identity"!==m.identifier&&n.push(this.serialzeFocus(m)),e.transform&&0!==e.transform.end.x&&0!==e.transform.end.y){var h=this.serializeTransform(e.transform),f=h.transform,c=h.orientation;n.push(f),n.push(c)}if(e.sprite&&e.sprite.spriteIdList.forEach((function(i){var t=e.sprite.common[i];switch(t.tool){case"sticker":var o=e.sprite.sticker[i];a.push(r.serializeSticker(o,t));break;case"text":var s=e.sprite.text[i];a.push(r.serializeText(s,t));break;case"textdesign":var n=e.sprite.textdesign[i];a.push(r.serializeTextDesign(n,t))}})),e.brush.strokes.length&&a.push({type:"brush",options:{paths:e.brush.strokes.map((function(e){return{points:e.path.controlPoints.map(r.relativeToImageDimensions),brush:{color:{rgba:e.brush.color},size:r.relativeToShotestImageEdge(e.brush.size),hardness:e.brush.hardness}}}))}}),a.length){var g={type:"sprite",options:{sprites:a}};n.push(g)}var v={assets:{stickers:e.customStickers||[]}};return{version:t.version,meta:o,image:s,operations:n,assetLibrary:v}},t.prototype.serializeMetaData=function(){return{platform:"html5",version:n,createdAt:(new Date).toISOString()}},t.prototype.serializeFilters=function(e){return{type:"filter",options:{intensity:e.intensity,identifier:e.identifier}}},t.prototype.serializeAdjustments=function(e){return{type:"adjustments",options:e}},t.prototype.serialzeFrame=function(e){return{type:"frame",options:{identifier:e.identifier,alpha:e.opacity,tintColor:{rgba:e.color},size:this.relativeToShotestImageEdge(e.width)}}},t.prototype.serialzeOverlay=function(e){return{type:"overlay",options:{identifier:e.identifier,intensity:e.opacity,blendMode:e.blendMode.replace(/[A-Z]/g,(function(e){return" "+e.toLowerCase()}))}}},t.prototype.serialzeFocus=function(i){switch(i.identifier){case e.LINEAR:return{type:"focus",options:{type:"linear",options:{start:this.previewRelativeToImageDimensions(i.linear.start),end:this.previewRelativeToImageDimensions(i.linear.end),blurRadius:this.relativeToShotestImageEdge(i.linear.blurRadius)}}};case e.RADIAL:return{type:"focus",options:{type:"radial",options:{start:this.previewRelativeToImageDimensions(i.radial.center),end:this.previewRelativeToImageDimensions(this.getPointInDirection(i.radial.center,0,i.radial.radius)),blurRadius:this.relativeToShotestImageEdge(i.radial.blurRadius),gradientRadius:.1}}};case e.MIRRORED:var t=i.mirrored,r=Math.sqrt(Math.pow(this.previewSize.width,2)+Math.pow(this.previewSize.height,2));return{type:"focus",options:{type:"mirrored",options:{start:this.previewRelativeToImageDimensions(this.getPointInDirection(t.origin,t.rotation,r/2)),end:this.previewRelativeToImageDimensions(this.getPointInDirection(t.origin,t.rotation,-r/2)),size:this.relativeToShotestImageEdge(i.mirrored.size),blurRadius:this.relativeToShotestImageEdge(i.mirrored.blurRadius),gradientSize:.1}}};default:return{type:"focus",options:{type:"gaussian",options:{blurRadius:this.relativeToShotestImageEdge(i.gaussian.blurRadius)}}}}},t.prototype.serializeSticker=function(e,i){return{type:"sticker",options:{position:this.previewRelativeToImageDimensions(i.position),dimensions:{x:this.relativeToShotestImageEdge(i.size.width),y:this.relativeToShotestImageEdge(i.size.height)},rotation:i.rotation,flipVertically:!1,flipHorizontally:!1,identifier:e.identifier,alpha:e.opacity,tintColor:{rgba:e.tintColor},tintMode:e.tintMode}}},t.prototype.serializeText=function(e,i){return{type:"text",options:{position:this.previewRelativeToImageDimensions(i.position),rotation:i.rotation,flipVertically:!1,flipHorizontally:!1,fontIdentifier:e.identifier,fontSize:this.relativeToShotestImageEdge(e.fontSize),maxWidth:this.serializeMaxWidth(e.width),text:e.text,lineHeight:e.lineHeight,color:{rgba:e.textColor},backgroundColor:{rgba:e.backgroundColor},alignment:e.alignment}}},t.prototype.serializeTextDesign=function(e,i){return{type:"textdesign",options:{position:this.previewRelativeToImageDimensions(i.position),rotation:i.rotation,flipVertically:!1,flipHorizontally:!1,identifier:e.identifier,inverted:e.isInverted,width:this.serializeMaxWidth(e.width),seed:e.seed,padding:e.padding,text:e.text,color:{rgba:e.color}}}},t.prototype.serializeTransform=function(e){return{transform:{type:"transform",options:{start:this.relativeToImageDimensions(e.start),end:this.relativeToImageDimensions(e.end),rotation:e.rotation,meta:{identifier:e.identifier}}},orientation:{type:"orientation",options:{rotation:e.outputRotation,flipHorizontally:e.flipHorizontally,flipVertically:e.flipVertically}}}},t.version="3.8.0",t}(),l=function(e){return void 0===e&&(e=s.PNG),"data:"+e+";base64,"},p=function(){function e(e,t,r,o){var s=this;this.deserializeMaxWidth=function(e){return e*s.untransformedImageSize.width},this.previewRelativeToImageDimensions=function(e){return s.relativeToOutputContainer(new i(e).multiply(i.fromSize(s.previewSize)))},this.relativeToOutputContainer=function(e){return new i(e).add(new i(s.previewPosition))},this.relativeToImageDimensions=function(e){return new i(e).multiply(i.fromSize(s.previewSize))},this.relativeToShotestImageEdge=function(e){return e*Math.min(s.transformedImageSize.height,s.transformedImageSize.width)},this.previewPosition=e,this.previewSize=t,this.transformedImageSize=r,this.untransformedImageSize=o}return e.prototype.deserialise=function(e,i){var s=this;if("string"!=typeof e){var n={};return this.validateVersion(e.version)?(e.meta&&!this.checkIfPlatformHTML(e.meta.platform)&&console.warn("Platform mismatch"),e.image&&(n.image={width:e.image.width,height:e.image.height,data:e.image.data?e.image.data.replace(l(),""):""},n.image.data=n.image.data?l()+n.image.data:""),e.operations.forEach((function(e){switch(e.type){case"filter":n.filter=s.deserializeFilter(e.options);break;case"adjustments":n.adjustment=s.deserializeAdjustments(e.options);break;case"focus":n.focus=s.deserializeFocus(e.options);break;case"transform":n.transform||(n.transform=s.initializeEmptyOrientation()),n.transform.start=s.relativeToImageDimensions(e.options.start),n.transform.end=s.relativeToImageDimensions(e.options.end),n.transform.rotation=e.options.rotation||0;break;case"orientation":n.transform||(n.transform=s.initializeEmptyTransform()),n.transform.outputRotation=e.options.rotation,n.transform.flipHorizontally=e.options.flipHorizontally||!1,n.transform.flipVertically=e.options.flipVertically||!1;break;case"sprite":e.options.sprites.forEach((function(e){switch(e.type){case"frame":n.frame=s.deserializeFrame(e.options);break;case"overlay":n.overlay=s.deserializeOverlay(e.options);break;case"sticker":case"text":case"textdesign":n.sprite||(n.sprite={spriteIdList:[],sticker:{},text:{},textdesign:{},common:{}});var i=t();n.sprite.spriteIdList.push(i),n.sprite.common[i]={position:s.previewRelativeToImageDimensions(e.options.position),tool:r.STICKER,rotation:e.options.rotation||0,flipHorizontally:e.options.flipHorizontally,flipVertically:e.options.flipVertically},e.type===r.STICKER?(n.sprite.common[i].size={width:s.relativeToShotestImageEdge(e.options.dimensions.x),height:s.relativeToShotestImageEdge(e.options.dimensions.y)},n.sprite.sticker[i]=s.deserializeStickers(e.options)):e.type===r.TEXT?(n.sprite.common[i].tool=r.TEXT,n.sprite.text[i]=s.deserializeTexts(e.options)):e.type===r.TEXT_DESIGN&&(n.sprite.common[i].tool=r.TEXT_DESIGN,n.sprite.textdesign[i]=s.deserializeTextDesign(e.options))}}))}})),e.assetLibrary&&(n.customStickers=e.assetLibrary&&e.assetLibrary.assets&&e.assetLibrary.assets.stickers||[],n.customStickers=n.customStickers.map((function(e){var i=e.raster.data.replace(l(e.raster.type),"");return o({},e,{raster:o({},e.raster,{data:l(e.raster.type)+i})})}))),n):(i({identifier:"unsupportedVersion",message:e.version}),null)}throw new Error("Invalid input of type string, please provide an object")},e.prototype.deserializeFilter=function(e){return{intensity:e.intensity,identifier:e.identifier}},e.prototype.deserializeAdjustments=function(e){return o({},e)},e.prototype.deserializeFrame=function(e){return{identifier:e.identifier,opacity:e.alpha,width:this.relativeToShotestImageEdge(e.size),color:this.deserialzeColor(e.tintColor)}},e.prototype.deserializeOverlay=function(e){return{identifier:e.identifier,opacity:e.intensity,blendMode:e.blendMode.replace(/([ _][a-z])/g,(function(e){return e.toUpperCase().replace(" ","").replace("_","")}))}},e.prototype.deserializeFocus=function(e){switch(e.type){case"linear":return{identifier:"linear",linear:this.deserializeLinearFocus(e.options)};case"gaussian":return{identifier:"gaussian",gaussian:this.deserializeGaussianFocus(e.options)};case"radial":return{identifier:"radial",radial:this.deserializeRadialFocus(e.options)};case"mirrored":return{identifier:"mirrored",mirrored:this.deserializeMirroredFocus(e.options)}}},e.prototype.deserializeRadialFocus=function(e){return{center:this.previewRelativeToImageDimensions(e.start),radius:this.previewRelativeToImageDimensions(e.start).subtract(this.previewRelativeToImageDimensions(e.end)).magnitude,blurRadius:this.relativeToShotestImageEdge(e.blurRadius)}},e.prototype.deserializeLinearFocus=function(e){return{start:this.previewRelativeToImageDimensions(e.start),end:this.previewRelativeToImageDimensions(e.end),blurRadius:this.relativeToShotestImageEdge(e.blurRadius)}},e.prototype.deserializeGaussianFocus=function(e){return{blurRadius:this.relativeToShotestImageEdge(e.blurRadius)}},e.prototype.deserializeMirroredFocus=function(e){var i=this.previewRelativeToImageDimensions(e.start).subtract(this.previewRelativeToImageDimensions(e.end));return{origin:this.previewRelativeToImageDimensions(e.start).add(this.previewRelativeToImageDimensions(e.end)).divide(2),rotation:Math.atan2(i.y,i.x),size:this.relativeToShotestImageEdge(e.size),blurRadius:this.relativeToShotestImageEdge(e.blurRadius)}},e.prototype.deserializeStickers=function(e){return{identifier:e.identifier,opacity:e.alpha||0,tintMode:e.tintMode||"none",tintColor:this.deserialzeColor(e.tintColor)}},e.prototype.deserializeTexts=function(e){return{identifier:e.fontIdentifier,fontSize:this.relativeToShotestImageEdge(e.fontSize),width:this.deserializeMaxWidth(e.maxWidth),alignment:e.alignment,textColor:this.deserialzeColor(e.color),backgroundColor:this.deserialzeColor(e.backgroundColor),lineHeight:e.lineHeight,text:e.text}},e.prototype.deserializeTextDesign=function(e){return{identifier:e.identifier,width:this.deserializeMaxWidth(e.width),padding:e.padding,color:this.deserialzeColor(e.color),seed:e.seed,text:e.text,isInverted:e.inverted}},e.prototype.initializeEmptyOrientation=function(){return{outputRotation:0,flipHorizontally:!1,flipVertically:!1}},e.prototype.initializeEmptyTransform=function(){return{start:{x:0,y:0},end:{x:0,y:0},rotation:0}},e.prototype.deserialzeColor=function(e){if(e){if(e.rgba)return e.rgba;if(e.srgba)return e.srgba}},e.prototype.validateVersion=function(i){return e.version===i},e.prototype.checkIfPlatformHTML=function(e){return"html5"===e},e.version="3.8.0",e}();export{p as Deserializer,a as Serializer};
